import{Errors as t}from"../constants/errors.js";import{isWebAuthPlatformAvailable as e}from"./browser-capabilities.js";import{base64UrlToUint8Array as a,uint8ArrayToBase64Url as r}from"./codec.js";function n(t){return t?r(t):null}async function i(r){if(!r?.challenge)throw new Error(t.PASSKEY_PUBLIC_KEY_UNAVAILABLE);const i=await e(),o=a(r.challenge),c=await navigator.credentials.get({publicKey:{challenge:o}});if(!c)throw new Error(t.PASSKEY_CREDENTIALS_UNAVAILABLE);if(!function(t){return void 0!==t.authenticatorData}(c.response))throw new Error(t.PASSKEY_EXPECTED_ASSERTION_RESPONSE);const s=c.response;return{id:c.id,rawId:n(c.rawId??null),type:c.type,authenticatorAttachment:c.authenticatorAttachment,response:{clientDataJSON:n(s.clientDataJSON??null),authenticatorData:n(s.authenticatorData??null),signature:n(s.signature??null),userHandle:n(s.userHandle??null)},isUserVerifyingPlatformAuthenticatorAvailable:i}}async function o(e){if(!e?.challenge)throw new Error(t.PASSKEY_PUBLIC_KEY_UNAVAILABLE);const n=function(t){const{challenge:e,user:r,authenticatorSelection:n,pubKeyCredParams:i,rp:o}=t;return{rp:o,user:{id:a(r.id),name:r.name,displayName:r.displayName},challenge:a(e),pubKeyCredParams:i.map((({alg:t})=>({type:"public-key",alg:t}))),authenticatorSelection:{...n,residentKey:n.residentKey,userVerification:n.userVerification},attestation:"direct"}}(e),i=await navigator.credentials.create({publicKey:n});if(!i)throw new Error(t.PASSKEY_CREATE_FAILED);const o=i.response;return{id:i.id,rawId:r(i.rawId),type:i.type,authenticatorAttachment:i.authenticatorAttachment,response:{clientDataJSON:r(o.clientDataJSON),attestationObject:r(o.attestationObject),transports:"function"==typeof o?.getTransports?o.getTransports():void 0}}}export{o as createPasskeyCredentials,i as getPasskeyCredentials};
//# sourceMappingURL=passkeys.js.map
